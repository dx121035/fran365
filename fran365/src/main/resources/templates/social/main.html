<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout=http:www.ultraq.net.nz/thymeleaf/layout
      layout:decorate="~{fragments/layout1}">

<div layout:fragment="content">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<div class="container">
<div class="content">
    <div class="pb-10">
        <div class="row gy-3 gx-5 gx-xxl-6">
            <div class="col-lg-5 col-xl-4 d-none d-lg-block">
                <div class="card mb-5">
                    <div class="card-header hover-actions-trigger position-relative mb-7" style="min-height: 130px; ">
                        <div class="bg-holder rounded-top" style="background-image: linear-gradient(0deg, #000000 -3%, rgba(0, 0, 0, 0) 83%)">
                            <input class="d-none" id="upload-feed-cover-image" type="file" />
                            <label class="cover-image-file-input" for="upload-feed-cover-image"></label>
                            <div class="hover-actions end-0 bottom-0 pe-1 pb-2 text-white"><span class="fa-solid fa-camera me-2 overlay-icon"> </span></div>
                        </div>
                        <input class="d-none" id="upload-feed-porfile-picture" type="file" />
                        <label class="avatar avatar-4xl status-online feed-avatar-profile cursor-pointer" for="upload-feed-porfile-picture"><img class="rounded-circle img-thumbnail bg-white shadow-sm"  th:src="@{|${awspath}/${member.image}|}" width="200" alt="" /></label>
                    </div>
                    <div class="card-body" style="word-break: break-all">
                        <div class="row" >
                            <div class="col-12">
                                <div class="d-flex flex-wrap mb-3 align-items-center">
                                    <h3 class="me-2">[[${member.username}]]</h3><span class="fw-normal fs-0">[[${member.name}]]</span>
                                </div>
                                    <div id="tableExample3" data-list='{"valueNames":["content","createDate","status"]}'>
                                        <div class="search-box mb-3 mx-auto">
                                            <form class="position-relative" data-bs-toggle="search" data-bs-display="static">
                                                <input class="form-control search-input search form-control-sm" type="search" placeholder="Search" aria-label="Search" />
                                                <span class="fas fa-search search-box-icon"></span>
                                            </form>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-sm fs--1 mb-0">
                                                <thead>
                                                <tr>
                                                    <th class="sort border-top ps-3" style="width: 45%" data-sort="content">내용</th>
                                                    <th class="sort border-top" data-sort="createDate" style="width: 30%">작성일</th>
                                                    <th class="sort border-top" data-sort="status" style="width: 20%">공개</th>
                                                    <th class="sort text-end align-middle pe-0 border-top" scope="col" style="width: 5%"></th>

                                                </tr>
                                                </thead>
                                                <tbody class="list">
                                                <th:block th:each="list:${lists}">
                                                <tr>
                                                    <td class="content align-middle ps-3"><div class="listPictureRemove mb-0" style="margin-top: 15px;" th:id="'content-' + ${list.id}" th:data-id="${list.id}"  th:utext="${list.content}"></div></td>
                                                    <td class="createDate align-middle"><div th:text="${#temporals.format(list.createDate, 'yy-MM-dd HH:mm')}"></div></td>
                                                    <td class="status align-middle">

                                                        <button class="set-status badge badge-phoenix fs--1 badge-phoenix-danger" th:if="${list.status == '0'}" th:data-post-id="${list.id}" data-status="1">비공개</button>
                                                        <button class="set-status badge badge-phoenix fs--1 badge-phoenix-success" th:if="${list.status == '1'}" th:data-post-id="${list.id}" data-status="0">공개</button></td>

                                                    <td class="align-middle white-space-nowrap text-end pe-0">
                                                        <div class="font-sans-serif btn-reveal-trigger position-static">
                                                            <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal fs--2" type="button" data-bs-toggle="dropdown" data-boundary="window" aria-haspopup="true" aria-expanded="false" data-bs-reference="parent"><span class="fas fa-ellipsis-h fs--2"></span></button>
                                                            <div class="dropdown-menu dropdown-menu-end py-2"> <button class="view-button" th:data-id="${list.id}">View</button><button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#exampleModal" th:data-status="${list.status}" th:data-id="${list.id}" th:data-content="${list.content}">수정</button>
                                                                <div class="dropdown-divider"></div><a class="dropdown-item text-danger" th:href="@{|/social/delete?id=${list.id}|}">삭제</a>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                </th:block>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-7 col-xl-8">

                <div class="card d-flex flex-column mb-5" style="border: none;">
                    <form action="/social/create" method="post">
                        <input type="hidden" id="content-id" name="contentId">
                        <textarea type="text" id="summernote" name="content"></textarea>
                        <input type="hidden" name="image" th:value="${member.image}">
                        <div style="display: flex; justify-content: center;">
                        <input type="submit" class="btn btn-primary" style="margin-top: 5px;" value="등록">
                        </div>
                    </form>
                </div>

                <div class="mb-9">
                    <br>
                    <th:block th:each="detail, loop : ${paging}">
                    <div class="mb-5">
                        <div class="card mb-4">

                            <div class="card-body p-3 p-sm-4">

                                <div id="detail-1"></div>
                                <div class="border-bottom mb-3">
                                    <div class="d-flex align-items-center mb-3"><a href="../../apps/social/profile.html">
                                        <div class="avatar avatar-xl  me-2">
                                            <img class="rounded-circle " th:src="@{|${awspath}/${detail.image}|}" alt="" />

                                        </div>
                                    </a>
                                        <div th:id="'detail-' + ${detail.id}">
                                        <div class="flex-1"><a class="fw-bold mb-0 text-black" href="../../apps/social/profile.html">[[${detail.username}]]</a>

                                            <p class="fs--2 mb-0 text-600 fw-semi-bold"><div th:text="${#temporals.format(detail.createDate, 'yyyy년 MM월 dd일 HH:mm')}"></div><span class="fa-solid fa-circle text-300" data-fa-transform="shrink-10 down-2"></span>대한민국<span class="fa-solid fa-circle text-300" data-fa-transform="shrink-10 down-2"></span><span class="fa-solid fa-earth-americas text-900"></span>
                                            </p>
                                        </div>
                                        </div>
                                        <div th:if="${#authorization.expression('hasRole(''ADMIN'')') or #authentication.name == detail.username}" class="btn-reveal-trigger">
                                            <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none d-flex btn-reveal" type="button" data-bs-toggle="dropdown" data-boundary="window" aria-haspopup="true" aria-expanded="false" data-bs-reference="parent"><span class="fas fa-ellipsis-h"></span></button>
                                            <div class="dropdown-menu dropdown-menu-end py-2"><button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#exampleModal" th:data-status="${detail.status}" th:data-id="${detail.id}" th:data-content="${detail.content}">수정</button><a class="dropdown-item text-danger" th:href="@{|/social/delete?id=${detail.id}|}">삭제</a></div>
                                        </div>

                                    </div>

                                        [(${detail.content})]


                                </div>
                                <div class="d-flex">
                                    <a href="javascript:void(0);" class="btn btn-link p-0 me-3 fs--1 fw-bolder recommend" th:data-uri="@{|/social/like?id=${detail.id}|}" style="color: red; text-decoration-color: red;">
                                        <span class="fa-solid fa-heart me-1" style="color: red;"></span><span th:utext="${#lists.size(detail.liker)}" style="color: #ff0000;"></span> 공감
                                    </a>
                                    <button class="btn btn-link text-900 p-0 fs--1 me-3 fw-bolder" type="button"><span class="fa-solid fa-comment me-1"></span><span th:utext="${#lists.size(detail.commentList)}"></span> 댓글
                                    </button>
                                </div>
                            </div>



                            <div class="bg-white border-top p-3 p-sm-4">
                                <th:block th:each="comment: ${detail.commentList}">
                                <div class="d-flex align-items-start">

                                    <!--comment-->

                                    <div class="avatar avatar-m me-2">
                                        <img class="rounded-circle " th:src="@{|${awspath}/${comment.image}|}" alt="" />
                                    </div>

                                    <div class="flex-1">

                                        <div class="d-flex align-items-center">[[${comment.username}]]<span class="text-600 fw-semi-bold fs--2 ms-2">[[${#temporals.format(comment.createDate, 'yyyy년 MM월 dd일 HH:mm')}]]</span></div>
                                        <p class="mb-0">[[${comment.content}]] <a th:if="${#authorization.expression('hasRole(''ADMIN'')') or #authentication.name == comment.username}" th:href="@{|/comment/delete?id=${comment.id}|}" style="color: red; text-decoration-color: red;"><span class="far fa-times-circle fs--2 me-1" style="color: red;"></span><span class="fw-bold fs--2" style="color: red;">삭제</span></a></p>

                                        <button class="btn btn-link p-0 text-900 fw-bolder mb-2" data-bs-toggle="collapse" th:data-bs-target="'#collapseExample' + ${comment.id}" aria-expanded="false"><span class="fa-solid fa-reply fs--2 me-1"></span><span class="fw-bold fs--2">답글 <span th:utext="${#lists.size(comment.comment2List)}"></span></span></button>

                                        <!--comment2-->

                                        <div class="collapse"  th:id="'collapseExample' + ${comment.id}">
                                            <form action="/comment2/create" method="post">
                                                <textarea class="form-control" name="content" id="message-text" placeholder="내용을 입력해주세요"></textarea>
                                                <input type="hidden" class="form-control" name="cid" th:value="${comment.id}">
                                                <input type="hidden" class="form-control" name="sid" th:value="${detail.id}" id="recipient-name">
                                                <input type="hidden" class="form-control" name="image" th:value="${member.image}">
                                                <input type="submit" class="btn btn-primary" style="margin-top: 5px; margin-bottom: 5px;" value="등록">
                                            </form>
                                        </div>

                                        <th:block th:if="${comment.comment2List != null and #lists.size(comment.comment2List) > 0}" th:each="comment2 : ${comment.comment2List}">
                                            <div class="d-flex align-items-start mb-3">
                                                <div class="avatar avatar-m  me-2">
                                                    <img class="rounded-circle " th:src="@{|${awspath}/${comment2.image}|}" alt="" />
                                                </div>
                                                <div class="flex-1">
                                                    <div class="d-flex align-items-center">[[${comment2.username}]]<span class="text-600 fw-semi-bold fs--2 ms-2">[[${#temporals.format(comment2.createDate, 'yyyy년 MM월 dd일 HH:mm')}]]</span></div>
                                                    <p class="mb-0">[[${comment2.content}]] <a th:if="${#authorization.expression('hasRole(''ADMIN'')') or #authentication.name == comment2.username}" th:href="@{|/comment2/delete?id=${comment2.id}|}" style="color: red; text-decoration-color: red;"><span class="far fa-times-circle fs--2 me-1" style="color: red;"></span><span class="fw-bold fs--2" style="color: red;">삭제</span></a></p>
                                                </div>
                                            </div>
                                        </th:block>
                                    </div>
                                </div>
                                </th:block>
                            </div>
                                <!--input-->
                            <div class="container" style="padding: 10px;">
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-m  me-2">
                                        <img class="rounded-circle " th:src="@{|${awspath}/${member.image}|}" alt="" />
                                    </div>
                                    <div class="flex-1">
                                        <form class="comment-form" action="/comment/create" method="post">
                                            <textarea class="form-control" type="text" name="content" placeholder="내용을 입력해주세요"></textarea>
                                            <input type="hidden" class="post-id" name="id" th:value="${detail.id}" data-post-id="${detail.id}" />
                                            <input type="hidden" name="username" value="${detail.username}">
                                            <input type="hidden" name="image" th:value="${member.image}">
                                            <input type="submit" class="create-comment btn btn-primary" style="margin-top: 5px;" value="등록">
                                        </form>
                                    </div>
                                </div>
                        </div>
                            </div>
                        </div>
                    </th:block>
                    </div>
                </div>
                <div class="text-center"><a class="btn btn-link fs-0 p-0" href="#!">Load more</a>

                    <li class="page-item" th:classappend="${!paging.hasNext} ? disabled">
                        <a class="page-link" th:href="@{|?page=${paging.number+1}|}">
                            <span>더보기</span>
                        </a>
                    </li>


                </div>
            </div>
        </div>
    </div>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" style="height: 80%;">
        <div class="modal-content">
            <form action="/social/update" method="post">
                <input type="hidden" id="post-id" name="id" value="">
                <input type="hidden" id="status" name="status" value="">
            <div class="modal-header">
                <h3 class="modal-title fs-5" id="exampleModalLabel">게시물 수정</h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                    <div class="mb-3">
                        <label  class="col-form-label">Message:</label>
                        <textarea type="text" id="summernote2" name="content"></textarea>
                    </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

                <input type="submit" value="수정" class="btn btn-primary"></input>
            </div>
            </form>
        </div>
    </div>
</div>


<script>
    $(document).ready(function() {


        $('#summernote').summernote({
            tabsize: 2,
            height: 200,
        });

        $(".set-status").click(function() {
            var postId = $(this).data('post-id');
            var status = $(this).data('status');
            $.ajax({
                url: '/social/feedStatus',
                method: 'POST',
                data: {
                    postId: postId,
                    status: status
                },
                success: function(response) {
                    alert('게시물 상태가 성공적으로 업데이트되었습니다.');
                    location.reload();
                },
                error: function(err) {
                    console.error(err);
                    alert('게시물 상태 업데이트 중 오류가 발생했습니다.');
                }
            });
        });

    const exampleModal = document.getElementById('exampleModal');
    if (exampleModal) {
        exampleModal.addEventListener('show.bs.modal', event => {
            const button = event.relatedTarget; // Button that triggered the modal
            const content = button.getAttribute('data-content'); // Extract the 'content' from the data attribute
            const modalTitle = exampleModal.querySelector('.modal-title');
            const postId = button.getAttribute('data-id'); // Assuming 'data-id' contains the post id
            const modalPostIdInput = exampleModal.querySelector('#post-id');  // Get the 'id' input field
            const status = button.getAttribute('data-status');
            const modalStatusInput = exampleModal.querySelector('#status');

            modalTitle.textContent = ` 게시물 수정`;
            modalPostIdInput.value = postId;
            modalStatusInput.value = status;
            $('#summernote2').summernote('code', content);
        });
    }

    $('#summernote2').summernote({
        tabsize: 2,
        height: 200,
    });




    });


    $(".create-comment").click(function () {

        var postId = $(this).closest('.comment-form').find('.post-id').data('post-id');
        var commentContent = $(this).closest('.comment-form').find('textarea[name="content"]').val();

        $.ajax({
            url: '/comment/create',
            method: 'POST',
            data: {
                id: postId,
                content: commentContent
            }
        });
    });

    $(".view-button").click(function(e) {
        e.preventDefault();

        var id = $(this).data('id');

        $('html, body').animate({
            scrollTop: $('#detail-' + id).offset().top
        }, 500);
    });


</script>

<script>
    const recommend_elements = document.getElementsByClassName("recommend");
    Array.from(recommend_elements).forEach(function(element) {
        element.addEventListener('click', function() {
            if(confirm("'공감' 하시겠습니까?")) {
                location.href = this.dataset.uri;
            };
        });
    });
</script>

<script>
    window.onload = function() {
        var contents = document.querySelectorAll('.listPictureRemove');
        contents.forEach(function(content) {
                var div = document.createElement('div');
                div.innerHTML = content.innerHTML;
                var images = div.getElementsByTagName('img');
                while(images.length > 0) {
                    images[0].parentNode.removeChild(images[0]);
                }
                content.innerHTML = div.innerHTML;
        });
    };
</script>




<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
</div>
</div>